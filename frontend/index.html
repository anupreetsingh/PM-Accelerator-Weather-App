<!-- Role: Frontend HTML file for the Weather App -->

<!-- Anupreet Singh, anupreet2226579@gmail.com -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>üå§Ô∏è Weather App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f5f1e8 0%, #e8dcc0 50%, #d4c4a8 100%);
      min-height: 100vh;
      color: #4a4a4a;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      color: #6b5b47;
    }

    .header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(107, 91, 71, 0.2);
    }

    .header p {
      font-size: 1.2rem;
      opacity: 0.8;
      font-weight: 300;
    }

    .creator-info {
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .creator {
      color: #6b5b47;
      font-size: 1rem;
      font-weight: 500;
    }

    .info-btn {
      background: rgba(255, 255, 255, 0.2);
      color: #6b5b47;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .info-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: #fefcf8;
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(107, 91, 71, 0.3);
      border: 1px solid #d4c4a8;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e8dcc0;
    }

    .modal-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #6b5b47;
    }

    .close {
      color: #8b7d5e;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close:hover {
      color: #6b5b47;
    }

    .pm-info h3 {
      color: #6b5b47;
      font-size: 1.3rem;
      margin: 25px 0 15px 0;
      font-weight: 600;
    }

    .pm-info p {
      color: #4a4a4a;
      line-height: 1.7;
      margin-bottom: 15px;
    }

    .service-item {
      background: #f5f1e8;
      padding: 20px;
      border-radius: 12px;
      margin: 15px 0;
      border-left: 4px solid #a89b7d;
    }

    .service-title {
      font-weight: 600;
      color: #6b5b47;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .service-description {
      color: #4a4a4a;
      line-height: 1.6;
    }

    .links {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 2px solid #e8dcc0;
    }

    .links a {
      color: #a89b7d;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .links a:hover {
      color: #6b5b47;
      text-decoration: underline;
    }

    .search-section {
      background: rgba(255, 252, 247, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(107, 91, 71, 0.15);
      border: 1px solid rgba(212, 196, 168, 0.3);
    }

    .search-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 15px 20px;
      border: 2px solid #d4c4a8;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #fefcf8;
    }

    .search-input:focus {
      outline: none;
      border-color: #a89b7d;
      box-shadow: 0 0 0 3px rgba(168, 155, 125, 0.1);
    }

    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #a89b7d 0%, #8b7d5e 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(168, 155, 125, 0.3);
    }

    .btn-secondary {
      background: #f5f1e8;
      color: #6b5b47;
      border: 2px solid #d4c4a8;
    }

    .btn-secondary:hover {
      background: #e8dcc0;
      transform: translateY(-2px);
    }

    .weather-card {
      background: rgba(255, 252, 247, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(107, 91, 71, 0.15);
      border: 1px solid rgba(212, 196, 168, 0.3);
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .current-weather {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f8f9fa;
    }

    .weather-icon {
      font-size: 4rem;
      margin-right: 20px;
    }

    .weather-info h2 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #6b5b47;
      margin-bottom: 5px;
    }

    .weather-info .location {
      font-size: 1.2rem;
      color: #8b7d5e;
      margin-bottom: 10px;
    }

    .weather-details {
      display: flex;
      gap: 20px;
      color: #8b7d5e;
      font-size: 0.9rem;
    }

    .forecast-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .forecast-table th {
      background: #f5f1e8;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #6b5b47;
      border-radius: 8px 8px 0 0;
    }

    .forecast-table td {
      padding: 15px;
      border-bottom: 1px solid #e8dcc0;
    }

    .forecast-table tr:hover {
      background: #f5f1e8;
    }

    .records-section {
      background: rgba(255, 252, 247, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(107, 91, 71, 0.15);
      border: 1px solid rgba(212, 196, 168, 0.3);
    }

    .records-section h3 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #6b5b47;
    }

    .record-card {
      background: #fefcf8;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid #d4c4a8;
      transition: all 0.3s ease;
    }

    .record-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(107, 91, 71, 0.15);
    }

    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .record-title {
      font-weight: 600;
      color: #6b5b47;
    }

    .record-location {
      color: #8b7d5e;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .record-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 8px;
    }

    .btn-danger {
      background: #c17f59;
      color: white;
    }

    .btn-danger:hover {
      background: #a66b4a;
    }

    .btn-success {
      background: #8b7d5e;
      color: white;
    }

    .btn-success:hover {
      background: #6b5b47;
    }

    .error {
      background: #f5e6e0;
      color: #a66b4a;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #d4c4a8;
      margin: 20px 0;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #8b7d5e;
    }

    .spinner {
      border: 3px solid #f5f1e8;
      border-top: 3px solid #a89b7d;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .date-inputs {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .date-input {
      padding: 12px 15px;
      border: 2px solid #d4c4a8;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: #fefcf8;
    }

    .date-input:focus {
      outline: none;
      border-color: #a89b7d;
      box-shadow: 0 0 0 3px rgba(168, 155, 125, 0.1);
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .search-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-input {
        min-width: auto;
      }
      
      .current-weather {
        flex-direction: column;
        text-align: center;
      }
      
      .weather-details {
        justify-content: center;
      }
      
      .record-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üå§Ô∏è Weather App</h1>
      <p>Get current weather and forecasts for any location</p>
      <div class="creator-info">
        <span class="creator">Created by Anupreet Singh</span>
        <button class="info-btn" onclick="showPMInfo()">‚ÑπÔ∏è About PM Accelerator</button>
      </div>
    </div>

    <div class="search-section">
      <div class="search-row">
        <input id="q" class="search-input" placeholder="Enter city, ZIP code, or coordinates (e.g., New York, 10001, or 40.7128,-74.0060)" />
        <button id="searchBtn" class="btn btn-primary">
          üîç Search Weather
        </button>
        <button id="geoBtn" class="btn btn-secondary">
          üìç My Location
        </button>
      </div>
      <div id="result"></div>
    </div>

    <div class="records-section">
      <h3>üìä Weather Records</h3>
      <div class="search-row">
        <input id="rq" class="search-input" placeholder="Location (city, ZIP, or coordinates)" />
        <div class="date-inputs">
          <input id="start" type="date" class="date-input" />
          <input id="end" type="date" class="date-input" />
        </div>
        <button id="saveBtn" class="btn btn-primary">üíæ Save Record</button>
      </div>
      <div class="search-row">
        <button id="refreshBtn" class="btn btn-secondary">üîÑ Refresh Records</button>
      </div>
      <div id="records"></div>
    </div>
  </div>

  <!-- PM Accelerator Info Modal -->
  <div id="pmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üöÄ Product Manager Accelerator Program</h2>
        <span class="close" onclick="closePMInfo()">&times;</span>
      </div>
      <div class="pm-info">
        <p>The Product Manager Accelerator Program is designed to support PM professionals through every stage of their careers. From students looking for entry-level jobs to Directors looking to take on a leadership role, our program has helped over hundreds of students fulfill their career aspirations.</p>
        
        <p>Our Product Manager Accelerator community are ambitious and committed. Through our program they have learnt, honed and developed new PM and leadership skills, giving them a strong foundation for their future endeavors.</p>
        
        <h3>Our Services:</h3>
        
        <div class="service-item">
          <div class="service-title">üöÄ PMA Pro</div>
          <div class="service-description">End-to-end product manager job hunting program that helps you master FAANG-level Product Management skills, conduct unlimited mock interviews, and gain job referrals through our largest alumni network. 25% of our offers came from tier 1 companies and get paid as high as $800K/year.</div>
        </div>
        
        <div class="service-item">
          <div class="service-title">üöÄ AI PM Bootcamp</div>
          <div class="service-description">Gain hands-on AI Product Management skills by building a real-life AI product with a team of AI Engineers, data scientists, and designers. We will also help you launch your product with real user engagement using our 100,000+ PM community and social media channels.</div>
        </div>
        
        <div class="service-item">
          <div class="service-title">üöÄ PMA Power Skills</div>
          <div class="service-description">Designed for existing product managers to sharpen their product management skills, leadership skills, and executive presentation skills.</div>
        </div>
        
        <div class="service-item">
          <div class="service-title">üöÄ PMA Leader</div>
          <div class="service-description">We help you accelerate your product management career, get promoted to Director and product executive levels, and win in the board room.</div>
        </div>
        
        <div class="service-item">
          <div class="service-title">üöÄ 1:1 Resume Review</div>
          <div class="service-description">We help you rewrite your killer product manager resume to stand out from the crowd, with an interview guarantee. Get started by using our FREE killer PM resume template used by over 14,000 product managers.</div>
        </div>
        
        <div class="service-item">
          <div class="service-title">üöÄ Free Training & Courses</div>
          <div class="service-description">We also published over 500+ free training and courses. Please go to our YouTube channel and Instagram to start learning for free today.</div>
        </div>
        
        <div class="links">
          <p><strong>Free Resources:</strong></p>
          <p>üìÑ <a href="https://www.drnancyli.com/pmresume" target="_blank">FREE PM Resume Template</a> (used by 14,000+ PMs)</p>
          <p>üì∫ <a href="https://www.youtube.com/c/drnancyli" target="_blank">YouTube Channel</a> - 500+ free training videos</p>
          <p>üì± <a href="https://www.instagram.com/drnancyli" target="_blank">Instagram @drnancyli</a> - Daily PM tips and insights</p>
        </div>
      </div>
    </div>
  </div>

<script>
const API = "http://127.0.0.1:8000";

// PM Accelerator Modal Functions
function showPMInfo() {
  document.getElementById('pmModal').style.display = 'block';
  document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

function closePMInfo() {
  document.getElementById('pmModal').style.display = 'none';
  document.body.style.overflow = 'auto'; // Restore scrolling
}

// Close modal when clicking outside of it
window.onclick = function(event) {
  const modal = document.getElementById('pmModal');
  if (event.target === modal) {
    closePMInfo();
  }
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closePMInfo();
  }
});

function emoji(code){
  if (code===0) return "‚òÄÔ∏è";
  if ([1,2].includes(code)) return "üå§Ô∏è";
  if (code===3) return "‚òÅÔ∏è";
  if ([45,48].includes(code)) return "üå´Ô∏è";
  if ([51,53,55,56,57].includes(code)) return "üå¶Ô∏è";
  if ([61,63,65,66,67].includes(code)) return "üåßÔ∏è";
  if ([71,73,75,77].includes(code)) return "‚ùÑÔ∏è";
  if ([80,81,82].includes(code)) return "üåßÔ∏è";
  if ([95,96,99].includes(code)) return "‚õàÔ∏è";
  return "üå°Ô∏è";
}

async function fetchJSON(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

function showLoading(elementId) {
  document.getElementById(elementId).innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading weather data...</p>
    </div>
  `;
}

document.getElementById('searchBtn').onclick = async () => {
  const q = document.getElementById('q').value.trim();
  if (!q) { 
    alert("Please enter a location to search"); 
    return; 
  }
  
  showLoading('result');
  try{
    const data = await fetchJSON(`${API}/api/weather/current-forecast?query=${encodeURIComponent(q)}`);
    renderWeather(data);
  }catch(e){ renderError(e); }
};

document.getElementById('geoBtn').onclick = async () => {
  if (!navigator.geolocation) {
    alert("Geolocation is not supported by your browser");
    return;
  }
  
  showLoading('result');
  navigator.geolocation.getCurrentPosition(async pos => {
    const q = `${pos.coords.latitude.toFixed(4)},${pos.coords.longitude.toFixed(4)}`;
    try{
      const data = await fetchJSON(`${API}/api/weather/current-forecast?query=${encodeURIComponent(q)}`);
      renderWeather(data);
    }catch(e){ renderError(e); }
  }, err => {
    renderError(new Error("Could not get location: " + err.message));
  });
};

function renderWeather(d){
  const r = document.getElementById('result');
  const cur = d.current;
  const five = d.next5days.map(day => {
    const date = new Date(day.date);
    const formattedDate = date.toLocaleDateString('en-US', { 
      weekday: 'short',
      month: 'short', 
      day: 'numeric'
    });
    return `<tr><td>${formattedDate}</td><td style="font-size: 1.5rem;">${emoji(day.weathercode)}</td><td>${day.tmin}¬∞C</td><td>${day.tmax}¬∞C</td></tr>`;
  }).join("");
  
  r.innerHTML = `
    <div class="weather-card">
      <div class="current-weather">
        <div class="weather-icon">${emoji(cur.weathercode)}</div>
        <div class="weather-info">
          <h2>${cur.temperature}¬∞C</h2>
          <div class="location">${d.resolved.name} ${d.resolved.country ? `(${d.resolved.country})` : ''} ${d.resolved.admin1 ? `- ${d.resolved.admin1}` : ''}</div>
          <div class="weather-details">
            <span>üí® Wind: ${cur.windspeed} m/s</span>
            <span>üïê ${new Date(cur.time).toLocaleTimeString()}</span>
          </div>
        </div>
      </div>
      
             <h3 style="margin-bottom: 15px; color: #6b5b47;">üìÖ 5-Day Forecast</h3>
      <table class="forecast-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Weather</th>
            <th>Min</th>
            <th>Max</th>
          </tr>
        </thead>
        <tbody>${five}</tbody>
      </table>
    </div>
  `;
}

function renderError(e){
  document.getElementById('result').innerHTML = `
    <div class="error">
      <strong>Error:</strong> ${e.message}
    </div>
  `;
}

document.getElementById('saveBtn').onclick = async () => {
  const q = document.getElementById('rq').value.trim();
  const s = document.getElementById('start').value;
  const e = document.getElementById('end').value;
  if(!q || !s || !e) {
    alert("Please fill in all fields: location, start date, and end date");
    return;
  }
  
  try{
    const r = await fetch(`${API}/api/records`, {
      method: "POST", 
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ query: q, start_date: s, end_date: e })
    });
    if(!r.ok) throw new Error(await r.text());
    await refreshRecords();
    alert("Record saved successfully! üéâ");
  }catch(err){ 
    alert("Error saving record: " + err.message); 
  }
};

document.getElementById('refreshBtn').onclick = refreshRecords;

async function refreshRecords(){
  const list = document.getElementById('records');
  list.innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading records...</p>
    </div>
  `;
  
  try {
    const rows = await fetchJSON(`${API}/api/records`);
    if (rows.length === 0) {
      list.innerHTML = `
        <div class="loading">
          <p>No records found. Create your first weather record above! üìä</p>
        </div>
      `;
      return;
    }
    
    list.innerHTML = rows.map(r => {
      const count = r.payload?.time?.length ?? 0;
      const startDate = new Date(r.start_date).toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      const endDate = new Date(r.end_date).toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      return `
        <div class="record-card">
          <div class="record-header">
            <div>
              <div class="record-title">Record #${r.id} ‚Äî ${startDate} ‚Üí ${endDate}</div>
              <div class="record-location">
                üìç ${r.location_name || 'Unknown location'}
                ${r.location_country ? `(${r.location_country})` : ''}
                ${r.location_admin1 ? ` - ${r.location_admin1}` : ''}
                ${r.location_coords ? ` [${r.location_coords}]` : ''}
              </div>
            </div>
                         <div style="color: #8b7d5e; font-size: 0.9rem;">
              ${count} days of data
            </div>
          </div>
          <div class="record-actions">
            <button class="btn btn-secondary btn-small" onclick="editRecord(${r.id})">‚úèÔ∏è Edit</button>
            <button class="btn btn-danger btn-small" onclick="deleteRecord(${r.id})">üóëÔ∏è Delete</button>
            <button class="btn btn-success btn-small" onclick="downloadJSON(${r.id})">üìÑ JSON</button>
            <button class="btn btn-success btn-small" onclick="downloadCSV(${r.id})">üìä CSV</button>
            <button class="btn btn-success btn-small" onclick="downloadMD(${r.id})">üìù Markdown</button>
          </div>
        </div>
      `;
    }).join("");
  } catch (error) {
    list.innerHTML = `
      <div class="error">
        <strong>Error loading records:</strong> ${error.message}
      </div>
    `;
  }
}

async function editRecord(id){
  const newStart = prompt("New start date (MM/DD/YYYY), leave blank to keep current");
  const newEnd = prompt("New end date (MM/DD/YYYY), leave blank to keep current");
  
  function parseDate(dateStr) {
    if (!dateStr) return null;
    const parts = dateStr.split('/');
    if (parts.length === 3) {
      const month = parts[0].padStart(2, '0');
      const day = parts[1].padStart(2, '0');
      const year = parts[2];
      return `${year}-${month}-${day}`;
    }
    return dateStr;
  }
  
  const body = {};
  if (newStart) body.start_date = parseDate(newStart);
  if (newEnd) body.end_date = parseDate(newEnd);
  if (!newStart && !newEnd) return;
  
  try {
    const r = await fetch(`${API}/api/records/${id}`, {
      method: "PATCH", 
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(body)
    });
    if(!r.ok) throw new Error(await r.text());
    await refreshRecords();
    alert("Record updated successfully! ‚ú®");
  } catch (error) {
    alert("Error updating record: " + error.message);
  }
}

async function deleteRecord(id){
  if(!confirm("Are you sure you want to delete record #" + id + "?")) return;
  
  try {
    const r = await fetch(`${API}/api/records/${id}`, { method: "DELETE" });
    if(!r.ok) throw new Error(await r.text());
    await refreshRecords();
    alert("Record deleted successfully! üóëÔ∏è");
  } catch (error) {
    alert("Error deleting record: " + error.message);
  }
}

function blobDownload(text, name, type){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type}));
  a.download = name;
  a.click();
}

async function downloadJSON(id){
  try {
    const r = await fetchJSON(`${API}/api/records/${id}`);
    blobDownload(JSON.stringify(r, null, 2), `weather-record-${id}.json`, "application/json");
  } catch (error) {
    alert("Error downloading JSON: " + error.message);
  }
}

async function downloadCSV(id){
  try {
    const r = await fetchJSON(`${API}/api/records/${id}`);
    const t = r.payload;
    let out = "Date,Min Temperature (¬∞C),Max Temperature (¬∞C)\n";
    (t.time || []).forEach((d,i)=>{
      const date = new Date(d);
      const formattedDate = date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      out += `${formattedDate},${t.temperature_2m_min[i]},${t.temperature_2m_max[i]}\n`;
    });
    blobDownload(out, `weather-record-${id}.csv`, "text/csv");
  } catch (error) {
    alert("Error downloading CSV: " + error.message);
  }
}

async function downloadMD(id){
  try {
    const r = await fetchJSON(`${API}/api/records/${id}`);
    const t = r.payload;
    let out = `# Weather Record ${id}\n\n| Date | Min (¬∞C) | Max (¬∞C) |\n|---|---:|---:|\n`;
    (t.time || []).forEach((d,i)=>{
      const date = new Date(d);
      const formattedDate = date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      out += `| ${formattedDate} | ${t.temperature_2m_min[i]} | ${t.temperature_2m_max[i]} |\n`;
    });
    blobDownload(out, `weather-record-${id}.md`, "text/markdown");
  } catch (error) {
    alert("Error downloading Markdown: " + error.message);
  }
}

// Load initial records
refreshRecords();
</script>
</body>
</html>
